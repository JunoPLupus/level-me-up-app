<form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="form-container">

  <mat-form-field appearance="outline">
    <mat-label>Título</mat-label>
    <input matInput formControlName="title" placeholder="Ex: Estudar Angular">
    <mat-error *ngIf="taskForm.get('title')?.hasError('required')">Obrigatório</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Tag</mat-label>
    <mat-select formControlName="tagId">
      @for (tag of tags; track tag.id) {
        <mat-option [value]="tag.id">{{ tag.name }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <div class="priority-section">
    <label for="input-prioridade">Prioridade: <strong>{{ getPriorityLabel(taskForm.get('priority')?.value) }}</strong></label>
    <mat-slider min="1" max="3" step="1" showTickMarks discrete [displayWith]="getPriorityLabel" >
      <input matSliderThumb
             formControlName="priority"
             id="input-prioridade"
             data-testid="input-prioridade">
    </mat-slider>
  </div>

  <div class="date-row">
    <mat-form-field appearance="outline">
      <mat-label>Data Início</mat-label>
      <input matInput [matDatepicker]="pickerStart" formControlName="startDate">
      <mat-datepicker-toggle matIconSuffix [for]="pickerStart"></mat-datepicker-toggle>
      <mat-datepicker #pickerStart></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="time-input">
      <mat-label>Hora</mat-label>
      <input matInput type="time" formControlName="startTime">
    </mat-form-field>
  </div>

  <div class="date-row">
    <mat-form-field appearance="outline">
      <mat-label>Data Término</mat-label>
      <input matInput [matDatepicker]="pickerEnd" formControlName="endDate">
      <mat-datepicker-toggle matIconSuffix [for]="pickerEnd"></mat-datepicker-toggle>
      <mat-datepicker #pickerEnd></mat-datepicker>
      <mat-error *ngIf="taskForm.errors?.['dateRange']">
        Término anterior ao início
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="time-input">
      <mat-label>Hora</mat-label>
      <input matInput type="time" formControlName="endTime">
    </mat-form-field>
  </div>

  <mat-form-field appearance="outline">
    <mat-label>Repetição</mat-label>
    <mat-select formControlName="frequency">
      @for (option of frequencyOptions; track option.value) {
        <mat-option [value]="option.value">{{ option.label }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Descrição</mat-label>
    <textarea matInput formControlName="description" rows="3"></textarea>
  </mat-form-field>

  @if (!isEditMode) {
    <div class="checkbox-row">
      <mat-checkbox formControlName="keepAdding">Continuar adicionando</mat-checkbox>
    </div>
  }

  <div class="actions">
    <button type="button" mat-button (click)="goBack()">Cancelar</button>
    <button type="submit" mat-raised-button color="primary" [disabled]="taskForm.invalid">
      {{ isEditMode ? 'Salvar' : 'Criar' }}
    </button>
  </div>
</form>
